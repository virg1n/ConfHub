<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Your head content -->
</head>
<body>
  <h1>{{ repo.name }}</h1>
  <p>Author: {{ author }}</p>
  <p>Created at: {{ repo.created_time|datetimeformat }}</p>

  <!-- Display Diagram if exists -->
  {% if diagram %}
      <div>
          <h3>Repository Diagram</h3>
          <img src="{{ url_for('static', filename=diagram.split('static/')[-1]) }}" alt="Repository Diagram" style="max-width: 600px;">
      </div>
  {% endif %}

  <div>
      <h3>Description</h3>
      <p>{{ description }}</p>
  </div>

  <div>
      <h3>Files</h3>
      <ul>
          {% for file in files %}
              <li>
                  <a href="{{ url_for('download_file', file_id=file.id) }}">{{ file.filename }}</a>
                  {% if current_user.get_id() == repo.user_id %}
                      - <a href="{{ url_for('delete_file', file_id=file.id) }}">Delete</a>
                  {% endif %}
              </li>
          {% endfor %}
      </ul>
  </div>

  <!-- Only the owner can see edit options -->
  {% if current_user.get_id()|int == repo.user_id %}
      <div>
          <h3>Edit Repository</h3>
          <form method="POST" enctype="multipart/form-data">
              <input type="hidden" name="action" value="add_files">
              <label>Add Files:</label>
              <input type="file" name="files" multiple>
              <button type="submit">Upload Files</button>
          </form>

          <form method="POST">
              <input type="hidden" name="action" value="update_description">
              <label>Update Description:</label><br>
              <textarea name="description" rows="5" cols="50">{{ description }}</textarea><br>
              <div>
                <label for="use_ai">Regenerate Description Using AI:</label>
                <input type="checkbox" id="use_ai" name="use_ai">
              </div>
              <button type="submit">Update Description</button>
          </form>

          <form method="POST" enctype="multipart/form-data">
              <input type="hidden" name="action" value="update_diagram">
              <label>Update Diagram:</label>
              <input type="file" name="diagram">
              <button type="submit">Upload Diagram</button>
          </form>
      </div>
  {% endif %}
    <a href="{{ url_for('all_repositories') }}">All Repositories</a>
    <a href="{{ url_for('create_repo') }}">Create Repository</a>
    <a href="{{ url_for('view_repositories') }}">My Repositories</a>
</body>
</html>